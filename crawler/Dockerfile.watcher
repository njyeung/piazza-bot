FROM golang:1.21-alpine AS builder

WORKDIR /build

COPY crawler/watcher/go.mod crawler/watcher/go.sum ./
RUN go mod download
COPY crawler/watcher/*.go ./
RUN CGO_ENABLED=0 GOOS=linux go build -o watcher .

# Runtime stage
FROM crawler-base
COPY --from=builder /build/watcher /app/

# Create parsers directory for dynamically written parser files
RUN mkdir -p /app/parsers

# Run the watcher
CMD ["/app/watcher"]
